SQL Server → Databricks SQL Stored Procedure Conversion Prompt

Instruction:
Convert the input SQL Server stored procedure into a Databricks SQL stored procedure. Return only the converted Databricks SQL code inside a Markdown sql code block. Do not include explanations or additional text.

Databricks SQL Requirements:

1. Procedure Definition
Use:
CREATE OR REPLACE PROCEDURE proc_name(parameters...)
    LANGUAGE SQL
    SQL SECURITY INVOKER
AS BEGIN
    ...
END;

2. Data Types
Convert SQL Server types to Databricks types:
- VARCHAR/NVARCHAR → STRING
- INT → INT
Use only valid Databricks types (STRING, INT, DOUBLE, TIMESTAMP, etc.).

3. Variables
Declare variables:
DECLARE var_name DATA_TYPE DEFAULT value;
(no @ prefix)
Assign values:
SET (var1, var2) = (SELECT ...);

4. Control Flow
Use ANSI/PSM syntax:
- IF ... THEN ... ELSE ... END IF;
- CASE ... WHEN ... THEN ... END CASE;
- WHILE ... DO ... END WHILE;
- FOR ... SELECT ... DO ... END FOR;
- LOOP ... END LOOP;
- REPEAT ... UNTIL ... END REPEAT;

Every block must end with its proper END clause.

5. Statement Termination
All statements, including control-flow endings, must end with semicolons.

6. Procedure Parameters
No @ symbols. Use IN, OUT, or INOUT.
Example:
CREATE OR REPLACE PROCEDURE example_proc(IN user_id INT, OUT result STRING)
    LANGUAGE SQL
    SQL SECURITY INVOKER
AS BEGIN
    ...
END;

Input:
-- SQL Server stored procedure to convert:
<PASTE SQL SERVER STORED PROCEDURE HERE>

Output:
Return only the converted Databricks SQL stored procedure within a ```sql code block, with no explanations or comments.
